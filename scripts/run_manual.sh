#!/bin/bash

echo "üöÄ FLUX API Image Generator (Manual Mode)"
echo "========================================="

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python 3 –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Python 3.7+"
    exit 1
fi

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –≤—Ö—ñ–¥–Ω–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
if [ ! -f "data/input/character.jpg" ]; then
    echo "‚ùå –§–∞–π–ª data/input/character.jpg –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
    exit 1
fi

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ .env —Ñ–∞–π–ª—É
if [ ! -f ".env" ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ"
    echo "üìù –°—Ç–≤–æ—Ä—é—é .env –∑ –ø—Ä–∏–∫–ª–∞–¥—É..."
    cp env.example .env
    echo "‚úÖ –§–∞–π–ª .env —Å—Ç–≤–æ—Ä–µ–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –¥–æ–¥–∞–π—Ç–µ –≤–∞—à API –∫–ª—é—á:"
    echo "   nano .env"
    exit 1
fi

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π –∑ —Ñ–ª–∞–≥–æ–º --user
echo "üì¶ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏–π —Ä–µ–∂–∏–º)..."
pip3 install --user -r requirements.txt

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è API
echo "üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API..."
cd "$(dirname "$0")/.."
python3 src/flux_generator/test_api.py

echo ""
echo "üéØ –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó..."
python3 main.py 